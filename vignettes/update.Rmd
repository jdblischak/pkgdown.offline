---
title: "Update cache"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{pkgdown.offline}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

pkgdown.offline needs to retrieve the cached frontend dependencies from
each pkgdown version (>= 2.1.0) and store them in package.
Every time a new pkgdown version released on CRAN, the new version support
needs to be added. pkgdown.offline also optimizes its package size by
deduplicating these cache files.

1. Open the package in development mode. Retrieve the raw pkgdown external
   dependencies cache for all supported pkgdown versions. For example:

```r
path_cache <- file.path(tempdir(), "pkgdown.offline")
pkgdown.offline:::update_cache("2.1.0", destdir = path_cache)
pkgdown.offline:::update_cache("2.1.1", destdir = path_cache)
pkgdown.offline:::update_cache("2.1.2", destdir = path_cache)
```

1. Create a minified cache in pkgdown.offline:

```r
pkgdown.offline:::minify_cache(path_cache)
```

1. Now the package contains the minified cache with deduplicated files in
   `inst/cache/`. Commit and push.

The `restore_cache()` function will be used automatically by `copy_to_cache()`
at runtime when pkgdown.offline is used to initialize or build site.
